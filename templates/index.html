<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Finance Learning Chat</title>

<style>
/* ===== Page Layout ===== */
body {
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(135deg, #b3d9ff, #e6f3ff);
    margin: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
}

header {
    background-color: #1f4e79;
    color: white;
    width: 100%;
    padding: 20px;
    font-size: 1.8em;
}

/* ===== Main Card ===== */
.container {
    width: 95%;
    max-width: 500px;
    margin-top: 20px;
    background: white;
    border-radius: 20px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.12);
    padding: 30px;
    display: flex;
    flex-direction: column;
}

.icons {
    text-align: center;
    font-size: 30px;
    margin-bottom: 10px;
}

h1 {
    text-align: center;
    color: #1f4e79;
}

.subtitle {
    text-align: center;
    margin-bottom: 20px;
    color: #4a4a4a;
}

/* ===== Start Form ===== */
.input-form input {
    width: 100%;
    padding: 12px;
    margin-bottom: 14px;
    border-radius: 10px;
    border: 2px solid #c6e0ff;
    background: #f7fbff;
}

.input-form button {
    width: 100%;
    padding: 14px;
    background: #1f4e79;
    color: white;
    border-radius: 10px;
    border: none;
    font-size: 16px;
    cursor: pointer;
}

/* ===== Chat Area ===== */
.chat-container {
    display: none;
    flex-direction: column;
    gap: 12px;
    max-height: 500px;
    overflow-y: auto;
}

/* ===== Topic Shortcuts ===== */
#topic-shortcuts {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

.topic-btn {
    padding: 8px 14px;
    background: #eef4ff;
    border: 1px solid #c6d6ff;
    border-radius: 20px;
    cursor: pointer;
    font-size: 0.9em;
    font-weight: 600;
    color: #1f4e79;
}

.topic-btn:hover {
    background: #dbe8ff;
}

/* ===== Tone Selector ===== */
#tone-select {
    width: 100%;
    padding: 8px 12px;
    border-radius: 10px;
    border: 1px solid #c6d6ff;
    font-size: 0.9em;
    background: #f7fbff;
}

/* ===== Chat Bubbles ===== */
.bubble {
    max-width: 75%;
    padding: 14px 20px;
    border-radius: 18px;
    line-height: 1.5;
}

.user-bubble {
    background: #c3e8ff;
    align-self: flex-end;
}

.teacher-bubble {
    background: #ffffff;
    align-self: flex-start;
}

.teacher-bubble::before {
    content: "üìò Teacher";
    display: block;
    font-size: 0.85em;
    color: #6c8cd5;
    margin-bottom: 6px;
}

/* ===== Chat Input ===== */
.chat-input-form {
    display: flex;
}

.chat-input-form input {
    flex: 1;
    padding: 12px;
    border-radius: 25px;
    border: 1px solid #ccc;
}

.chat-input-form button {
    margin-left: 10px;
    padding: 12px 18px;
    background: #6c8cd5;
    color: white;
    border-radius: 25px;
    border: none;
    cursor: pointer;
}
</style>
</head>

<body>

<header>Finance Learning Chat</header>

<div class="container">
    <div class="icons">üí∏üìòüíô</div>
    <h1>Finance Learning App</h1>
    <div class="subtitle">Learn money skills in a simple, friendly way.</div>

    <!-- ===== Start Form ===== -->
    <form id="start-form" class="input-form">
        <input name="u1" placeholder="Your finance situation" required>
        <input name="u2" placeholder="Your debt situation" required>
        <input name="u3" placeholder="How you save/manage money" required>
        <input name="u4" placeholder="Monthly income" required>
        <input name="u5" placeholder="Your goals using this app" required>
        <button type="submit">Start Learning</button>
    </form>

    <!-- ===== Chat Interface ===== -->
    <div class="chat-container" id="chat-container">

        <!-- Topic Buttons -->
        <div id="topic-shortcuts">
            <button class="topic-btn" data-topic="budgeting">üí∞ Budgeting</button>
            <button class="topic-btn" data-topic="debt">üí≥ Debt</button>
            <button class="topic-btn" data-topic="saving">üè¶ Saving</button>
            <button class="topic-btn" data-topic="bills">üßæ Bills</button>
        </div>

        <main id="chat-messages"></main>

        <!-- Tone Selector -->
        <div>
            <label style="font-size:0.9em;">Teacher tone:</label>
            <select id="tone-select">
                <option value="gentle">Gentle</option>
                <option value="direct">Direct</option>
                <option value="encouraging">Encouraging</option>
            </select>
        </div>

        <!-- Chat Input -->
        <form id="chat-form" class="chat-input-form">
            <input name="message" placeholder="Type your message..." required>
            <button type="submit">Send</button>
        </form>
    </div>
</div>

<script>
const startForm = document.getElementById('start-form');
const chatContainer = document.getElementById('chat-container');
const chatMessages = document.getElementById('chat-messages');
const chatForm = document.getElementById('chat-form');
const toneSelect = document.getElementById('tone-select');

/* Add message bubble */
function addMessage(content, role) {
    const div = document.createElement('div');
    div.className = 'bubble ' + (role === 'user' ? 'user-bubble' : 'teacher-bubble');
    div.innerHTML = content;
    chatMessages.appendChild(div);
    div.scrollIntoView({ behavior: "smooth" });
}

/* Start chat */
startForm.addEventListener('submit', async (e) => {
    e.preventDefault();

    const data = Object.fromEntries(new FormData(startForm).entries());
    startForm.style.display = 'none';
    chatContainer.style.display = 'flex';

    const res = await fetch('/start_chat', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify(data)
    });

    const result = await res.json();
    addMessage(result.reply, 'assistant');
});

/* Send typed message */
chatForm.addEventListener('submit', async (e) => {
    e.preventDefault();

    const input = chatForm.querySelector('input');
    const tone = toneSelect.value;
    const message = `Please respond in a ${tone} tone.\n${input.value}`;
    input.value = '';

    addMessage(message, 'user');

    const res = await fetch('/send_message', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({ message })
    });

    const result = await res.json();
    addMessage(result.reply, 'assistant');
});

/* Topic buttons */
document.querySelectorAll('.topic-btn').forEach(btn => {
    btn.addEventListener('click', async () => {
        const tone = toneSelect.value;
        const message = `Please respond in a ${tone} tone.\nI want help with ${btn.dataset.topic}`;

        addMessage(message, 'user');

        const res = await fetch('/send_message', {
            method: 'POST',
            headers: {'Content-Type':'application/json'},
            body: JSON.stringify({ message })
        });

        const result = await res.json();
        addMessage(result.reply, 'assistant');
    });
});
</script>

</body>
</html>
